
# 分库+分表
分库：一个数据库包括多张表，造成数据库过于庞大。把一个数据库拆成若干个数据库。分库的两种形式：水平分库和垂直分库。垂直分库就是把不同的表划分到不同的数据库；水平分库就是按照region进行分库，每个region都有自己的一套数据。    
分表：一个表中存储的行数过多，造成单表过大。可以进行水平切分和垂直切分。垂直切分就是竖着切一刀，是把大表中的列分成若干组，每组是一个表。水平切分就是横着来一刀，是根据数据中的某一列进行切分（此列被称为sharding column），其实就相当于把数据的某个键切分成了若干个区间。每个区间是一个表。    

（1）单库太大：数据库里面的表太多，所在服务器磁盘空间装不下，IO次数多CPU忙不过来。  
（2）单表太大：一张表的字段太多，数据太多。查询起来困难。  

# 分库分表产生的问题
* 外键约束就不能用了
* 联合查询困难，只能在代码层面实现联合查询。
* 需要支持分布式事务。  
* 跨节点分页、排序问题。
* 全局主键避免重复问题。不能依赖数据库的自增id，可以自己实现自增id服务。     
# sharding column与冗余存储
分库分表会使得查询变得非常复杂。例如考虑用户关系表，这个表有三个字段id，from_user,to_user，表示from_user关注了to_user。如果按照from_user进行分表，那么可以快速获取某个用户的关注列表，然而却无法获得用户的粉丝列表（需要枚举全部表并拼接起来，分表的意义大打折扣）；如果按照to_user进行分表，能够获取用户的粉丝列表，却无法快速获得用户的关注列表。  
那么如何解决这个问题呢？冗余存储。按照from_user分表一次，然后按照to_user分表一次。